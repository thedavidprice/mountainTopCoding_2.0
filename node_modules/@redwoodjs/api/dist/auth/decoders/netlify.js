"use strict";

var _Object$defineProperty = require("@babel/runtime-corejs3/core-js/object/define-property");

var _interopRequireDefault = require("@babel/runtime-corejs3/helpers/interopRequireDefault");

_Object$defineProperty(exports, "__esModule", {
  value: true
});

exports.netlify = void 0;

var _jsonwebtoken = _interopRequireDefault(require("jsonwebtoken"));

const netlify = (token, req) => {
  // Netlify verifies and decodes the JWT before the request is passed to our
  // Serverless function, so the decoded JWT is already available in production.
  // For development and test we can't verify the token because we don't have
  // the signing key. Just decoding the token is the best we can do to emulate
  // the native Netlify experience
  if (process.env.NODE_ENV === 'development' || process.env.NODE_ENV === 'test') {
    return _jsonwebtoken.default.decode(token);
  } else {
    const clientContext = req.context.clientContext;
    return (clientContext === null || clientContext === void 0 ? void 0 : clientContext.user) || null;
  }
};

exports.netlify = netlify;